<html lang="en">

<head>
    <title>Video-Phone</title>
    <script src="https://pbx-stg.oncallcx.vn/cti/ancti/ancti.js"></script>
</head>

<body>
    <button style="float: right;" id="call" onclick="clickCall()" type="button"><span id="status"></span><i id="hook"
            class="material-icons">Call</i></button>
    <video id="localView" playsInline autoPlay muted></video>
    <video id="remoteView" playsInline autoPlay muted></video>
    <script>

        let agent = AnCti.newAgent();
        let webphone;
        let audio = new Audio();
        audio.autoplay = true;

        agent.startApplicationSession({
            username: "phuln6@fpt.com",
            password: "Phuln6!!!",
        })

        agent.on("applicationsessionstarted", (event) => {
            webphone = agent.getDevice("sip:1973@term.115");

            // tell server that we want to use WebRTC (error handling omitted)
            webphone.monitorStart({ rtc: true });
        });

        // if WebRTC creates a media-stream we bind it to the corresponding elements
        agent.on('localstream', (event) => {
            document.getElementById('localView').srcObject = event.stream;
        });

        agent.on('remotestream', (event) => {
            document.getElementById('remoteView').srcObject = event.stream;
            audio.srcObject = event.stream;
        });

        document.clickCall = () => {
            let call = webphone.calls[0];
            if (!call) {
                // click without an active call -> start a video call to number 23
                webphone.makeCall("0917114338", { autoOriginate: "doNotPrompt", audio: true, video: true });
            } else if (call.localConnectionInfo == "alerting") {
                // click while we have an alerting call -> accept it
                call.answerCall({ audio: true, video: true });
            } else {
                // otherwise we release the call
                call.clearConnection();
            }
        }

    </script>
</body>

</html>